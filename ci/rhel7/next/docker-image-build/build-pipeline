#!/usr/bin/env groovy

properties([
    buildDiscarder(logRotator(numToKeepStr: '600', daysToKeepStr: '7')),
    disableConcurrentBuilds(),
])

// TODO: this is the pipeline for building docker images

pipeline {
  environment { 
      VERSION = "rhel7"
      FLAVOR = "products-next"
  }

  agent {label 'toaster-node' }
  // run every 3 hours
    stages {
      stage('prepare sandbox and install requirements') 
        {
          steps {
            sh "rm -rf sandbox"
            sh "virtualenv sandbox"
            sh "source sandbox/bin/activate"
            sh "sandbox/bin/pip install -r requirements.txt --upgrade"
          }
        }
       stage('2ndstage building')
        {
          steps {
             sh "uptime"
           }
        }
    }

  post {
    always {
      dir("${env.WORKSPACE}") {
        deleteDir()
       }
     }
  }

}
